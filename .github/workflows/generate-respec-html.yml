name: Generate Respec HTML
on:
  push:
    branches:
      - master
jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Get Source
        uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'
      - name: Install Selenium for Python
        run: python -m pip install --upgrade pip selenium==3.141.0
      - name: Install ChromeDriver
        uses: nanasess/setup-chromedriver@v1.0.3
      - name: Debug Info
        run: |
          google-chrome --version
          chromedriver --version
          python3 --version
      - name: Prepare Build Folder
        run: |
          rm -rf build
          mkdir -p build/format-registry/initdata
          mkdir -p build/format-registry/stream
      - name: Generate HTML
        run: |
          ./generate-respec-html.py encrypted-media-respec.html > build/index.html
          ./generate-respec-html.py format-registry/initdata/cenc-respec.html > build/format-registry/initdata/cenc.html
          ./generate-respec-html.py format-registry/initdata/index-respec.html > build/format-registry/initdata/index.html
          ./generate-respec-html.py format-registry/initdata/keyids-respec.html > build/format-registry/initdata/keyids.html
          ./generate-respec-html.py format-registry/initdata/webm-respec.html > build/format-registry/initdata/webm.html
          ./generate-respec-html.py format-registry/stream/index-respec.html > build/format-registry/stream/index.html
          ./generate-respec-html.py format-registry/stream/mp4-respec.html > build/format-registry/stream/mp4.html
          ./generate-respec-html.py format-registry/stream/webm-respec.html > build/format-registry/stream/webm.html
      - name: Update MarkDown Files
        run: |
          cp LICENSE.md README.md build/
          echo -e "\n\nThis branch holds the generated content served via GitHub Pages." >> build/README.md
      - name: Deploy to GitHub Pages ðŸš€
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: gh-pages
          FOLDER: build
          CLEAN: true # Automatically remove deleted files
